<%= simple_form_for @customer do |f| %>
  <%= render 'layouts/error_messages', object: @customer %>
  <h5>Basic Information</h5>
  <hr>

  <div class="row g-3">

    <div class="col-md-3">
      <%= f.input :code,
          label: "Customer Code *",
          placeholder: "Auto-generated if left blank",
          hint: "Leave blank for auto-generation", input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-6">
      <%= f.input :full_name,
          label: "Customer Name *",
          placeholder: "Enter customer name",
          required: true, input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-3">
      <%= f.input :customer_type,
          collection: @customer_types,
          include_blank: "Select type...",
          label: "Type",
          as: :select, input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-6">
      <%= f.input :legal_name,
          label: "Legal Name",
          placeholder: "Legal business name (if different)", input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-3">
      <%= f.input :dba_name,
          label: "DBA Name",
          placeholder: "Doing Business As", input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-3">
      <%= f.input :customer_category,
          label: "Category",
          collection: @customer_categories,
          include_blank: "Select category...",
          as: :select, input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-4">
      <%= f.input :industry_type,
          label: "Industry",
          placeholder: "e.g., Automotive, Electronics", input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-4">
      <%= f.input :customer_since,
          label: "Customer Since",
          as: :date, input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-4 mt-4">
      <%= f.input :is_active,
          label: "Active Customer",
          as: :boolean,
          input_html: { class: "form-check-input" } %>
    </div>

  </div>
  <h5>Contact Information</h5>
  <hr>

  <div class="row g-3">

    <div class="col-md-4">
      <%= f.input :email, placeholder: "company@example.com", input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-4">
      <%= f.input :phone_number, label: "Phone", placeholder: "(555) 123-4567", input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-4">
      <%= f.input :mobile, placeholder: "(555) 123-4567", input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-6">
      <%= f.input :website, placeholder: "https://www.example.com", input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-6">
      <%= f.input :fax %>
    </div>

  </div>

  <h5>Financial Settings</h5>
  <hr>
  <div class="row g-3">

    <div class="col-md-3">
      <%= f.input :credit_limit,
          label: "Credit Limit ($)",
          as: :decimal,
          input_html: { step: 0.01, class: 'form-control' } %>
          
    </div>

    <div class="col-md-3">
      <%= f.input :payment_terms,
          collection: @payment_terms,
          as: :select,
          include_blank: "Select terms...", input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-3">
      <%= f.input :default_currency,
          collection: @currencies,
          as: :select, input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-3">
      <%= f.input :discount_percentage,
          label: "Discount %",
          as: :decimal,
          input_html: { step: 0.01, min: 0, max: 100 } %>
    </div>

    <div class="col-md-4">
      <%= f.input :default_tax_code_id,
          collection: @tax_codes,
          label_method: :name,
          value_method: :id,
          include_blank: "Select tax code...", input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-4">
      <%= f.input :ein_number, label: "EIN Number" %>
    </div>

    <div class="col-md-4 mt-4">
      <%= f.input :tax_exempt, as: :boolean, label: "Tax Exempt" %>
    </div>

    <%# Tax-Exempt Fields %>
    <div class="col-12" id="taxExemptFields" style="<%= 'display:none;' unless @customer.tax_exempt? %>">
      <div class="row g-3">
        <div class="col-md-6">
          <%= f.input :tax_exempt_number, label: "Tax Exempt Certificate Number" %>
        </div>
      </div>
    </div>

  </div>

  <h5>Sales Information</h5>
  <hr>
  <div class="row g-3">

    <div class="col-md-4">
      <%= f.input :default_sales_rep_id,
        label: "Sales Representative",
        as: :select,
        collection: @sales_reps.map { |u| [u.email, u.id] },
        include_blank: "Select sales rep...", input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-4">
      <%= f.input :sales_territory,
        label: "Sales Territory",
        placeholder: "e.g., Northeast, West Coast" %>
    </div>

    <div class="col-md-4">
      <%= f.input :customer_acquisition_source,
        label: "Acquisition Source",
        as: :select,
        collection: @acquisition_sources,
        include_blank: "Select source...", input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-6">
      <%= f.input :expected_order_frequency,
        label: "Expected Order Frequency",
        as: :select,
        collection: @order_frequencies,
        include_blank: "Select frequency...", input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-6">
      <%= f.input :annual_revenue_potential,
        label: "Annual Revenue Potential ($)",
        as: :decimal,
        input_html: { step: 0.01, min: 0, class: 'form-control'}  %>
      
    </div>

  </div>

  <h5>Operations Settings</h5>
  <hr>
  <div class="row g-3">

    <div class="col-md-4">
      <%= f.input :default_warehouse_id,
        label: "Default Warehouse",
        as: :select,
        collection: @warehouses.map { |w| [w.name, w.id] },
        include_blank: "Select warehouse...", input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-4">
      <%= f.input :shipping_method,
        label: "Shipping Method",
        placeholder: "UPS Ground, FedEx, etc." %>
    </div>

    <div class="col-md-4">
      <%= f.input :freight_terms,
        label: "Freight Terms",
        as: :select,
        collection: @freight_terms,
        include_blank: "Select terms...", input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-12">
      <%= f.input :delivery_instructions,
        label: "Delivery Instructions",
        as: :text,
        rows: 2,
        placeholder: "Special delivery instructions..." %>
    </div>

  </div>

  <h5>Preferences</h5>
  <hr>
  <div class="row g-3">

    <div class="col-md-4">
      <%= f.input :preferred_communication_method,
        label: "Preferred Communication",
        as: :select,
        collection: @communication_methods, input_html: {class: 'form-control'} %>
    </div>

    <div class="col-md-8">
      <label class="form-label">Options</label>

      <div class="row">

        <div class="col-md-4">
          <%= f.input :marketing_emails_allowed,
            as: :boolean,
            label: "Marketing Emails" %>
        </div>

        <div class="col-md-4">
          <%= f.input :auto_invoice_email,
            as: :boolean,
            label: "Auto Email Invoices" %>
        </div>

        <div class="col-md-4">
          <%= f.input :allow_backorders,
            as: :boolean,
            label: "Allow Backorders" %>
        </div>

      </div>
    </div>

    <div class="col-12">
      <%= f.input :internal_notes,
        label: "Internal Notes",
        as: :text,
        rows: 3,
        placeholder: "Internal notes (not visible to customer)..." %>
    </div>

  </div>

  <div class="d-flex justify-content-between">

  <%= link_to(@customer.new_record? ? customers_path : customer_path(@customer),
              class: "btn btn-sm btn-outline-secondary") do %>
    Cancel
  <% end %>

  <%= f.button :submit,
        (@customer.new_record? ? "Create Customer" : "Update Customer"),
        class: "btn btn-primary btn-sm px-5" %>

</div>
<% end -%>