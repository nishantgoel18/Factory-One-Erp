<div class="grn-line-row border rounded p-3 mb-3 <%= 'bg-light' if f.object.persisted? %>">
  <div class="row align-items-start">
    <!-- Product -->
    <div class="col-md-3">
      <%= f.association :product,
          collection: Product.where(deleted: false, is_active: true, is_stocked: true).order(:name),
          label_method: lambda { |p| "#{p.sku} - #{p.name}" },
          value_method: :id,
          include_blank: 'Select Product',
          label: 'Product',
          input_html: { class: 'form-control form-control product-select' } %>
    </div>

    <!-- Quantity -->
    <div class="col-md-2">
      <%= f.input :qty,
          label: 'Quantity',
          input_html: { class: 'form-control form-control', min: 0, step: 0.01 } %>
    </div>

    <!-- UoM -->
    <div class="col-md-2">
      <%= f.association :uom,
          collection: UnitOfMeasure.non_deleted.order(:name),
          label_method: :symbol,
          value_method: :id,
          label: 'Unit',
          input_html: { class: 'form-control form-control' } %>
    </div>

    <!-- Location (Receivable only) -->
    <div class="col-md-3">
      <%= f.association :location,
          collection: Location.active.where(is_receivable: true).order(:name),
          label_method: lambda { |l| "#{l.code} - #{l.name}" },
          value_method: :id,
          include_blank: 'Select Location',
          label: 'Receiving Location',
          input_html: { class: 'form-control form-control location-select' } %>
    </div>

    <!-- Batch (if product is batch-tracked) -->
    <div class="col-md-1">
      <%= f.association :batch,
          collection: StockBatch.non_deleted,
          label_method: 'batch_number',
          value_method: :id,
          label: 'Batch',
          include_blank: 'Auto',
          input_html: { class: 'form-control form-control batch-select' },
          hint: 'Optional' %>
    </div>

    <!-- Remove Button -->
    <div class="col-md-1 text-end">
      <label class="form-label">&nbsp;</label>
      <button type="button" class="btn btn-xs btn-outline-danger remove-grn-line w-100">
        X
      </button>
      <%= f.input :_destroy, as: :hidden, input_html: { value: false } %>
    </div>

    <!-- Unit Cost (Optional) -->
    <div class="col-md-2 mt-2">
      <%= f.input :unit_cost,
          label: 'Unit Cost (Optional)',
          input_html: { class: 'form-control form-control', min: 0, step: 0.01 } %>
    </div>

    <!-- Line Note -->
    <div class="col-md-10 mt-2">
      <%= f.input :line_note,
          label: 'Line Notes',
          input_html: { class: 'form-control form-control', rows: 1, placeholder: 'Optional notes...' } %>
    </div>
  </div>
</div>