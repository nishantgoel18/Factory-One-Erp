<%# app/views/work_centers/show.html.erb %>

<div class="main-content">
  <%= render 'layouts/alerts' %>

  <div class="page-header">
    <h2 class="header-title">View Work Center</h2>
    <div class="header-sub-title">
      <nav class="breadcrumb breadcrumb-dash">
        <a href="/" class="breadcrumb-item"><i class="anticon anticon-home m-r-5"></i>Home</a>
        <a class="breadcrumb-item" href="#">Masters</a>
        <a class="breadcrumb-item" href="/work_centers">Work Centers</a>
        <span class="breadcrumb-item active">View Work Center</span>
      </nav>
    </div>
  </div>
  <!-- Breadcrumb & Header -->
  <div class="row mb-4">
    <div class="col-md-6">
      
      
      <h2 class="mb-0">
        <i class="fas fa-industry me-2"></i>
        <%= @work_center.code %>
      </h2>
      <p class="text-muted mb-0"><%= @work_center.name %></p>
    </div>
    <div class="col-md-6 text-end">
      <!-- Status Badge -->
      <% if @work_center.is_active? %>
        <span class="text-white badge bg-success fs-5 me-2">
          <i class="fas fa-check-circle me-1"></i> Active
        </span>
      <% else %>
        <span class="text-white badge bg-secondary fs-5 me-2">
          <i class="fas fa-times-circle me-1"></i> Inactive
        </span>
      <% end %>

      <!-- Action Buttons -->
      <div class="btn-group me-2">
        <%= link_to edit_work_center_path(@work_center), class: "btn btn-sm btn-warning" do %>
          <i class="fas fa-edit me-2"></i>Edit
        <% end %>
        
        <%= button_to toggle_status_work_center_path(@work_center), 
                      method: :patch,
                      class: "btn btn-sm btn-#{@work_center.is_active? ? 'secondary' : 'success'}",
                      data: { confirm: "Are you sure?" } do %>
          <i class="fas fa-power-off me-2"></i>
          <%= @work_center.is_active? ? "Deactivate" : "Activate" %>
        <% end %>
        
        <%= button_to work_center_path(@work_center), 
                      method: :delete,
                      class: "btn btn-sm btn-danger",
                      data: { confirm: "Are you sure you want to delete this work center?" } do %>
          <i class="fas fa-trash me-2"></i>Delete
        <% end %>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Left Column -->
    <div class="col-lg-8">
      <!-- Basic Information Card -->
      <div class="card  mb-4">
        <div class="card-header d-flex align-items-center bg-primary text-white">
          <h5 class="mb-0">
            <i class="fas fa-info-circle me-2"></i> Basic Information
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="text-muted small">Work Center Code</label>
              <div class="fs-5 fw-bold"><%= @work_center.code %></div>
            </div>
            <div class="col-md-6 mb-3">
              <label class="text-muted small">Work Center Name</label>
              <div class="fs-5"><%= @work_center.name %></div>
            </div>
            <div class="col-md-6 mb-3">
              <label class="text-muted small">Type</label>
              <div>
                <span class="text-white badge bg-secondary fs-6">
                  <%= @work_center.type_label %>
                </span>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label class="text-muted small">Status</label>
              <div>
                <% if @work_center.is_active? %>
                  <span class="text-white badge bg-success fs-6">Active</span>
                <% else %>
                  <span class="text-white badge bg-secondary fs-6">Inactive</span>
                <% end %>
              </div>
            </div>
            <% if @work_center.description.present? %>
              <div class="col-12 mb-3">
                <label class="text-muted small">Description</label>
                <div class="border rounded p-3 bg-primary">
                  <%= simple_format(@work_center.description) %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Location Card -->
      <div class="card  mb-4">
        <div class="card-header d-flex align-items-center bg-primary text-white">
          <h5 class="mb-0">
            <i class="fas fa-map-marker-alt me-2"></i> Location
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="text-muted small">Warehouse</label>
              <div class="fs-5">
                <% if @work_center.warehouse.present? %>
                  <%= @work_center.warehouse.name %>
                  <small class="text-muted">(#<%= @work_center.warehouse.code %>)</small>
                <% else %>
                  <span class="text-muted">Not assigned</span>
                <% end %>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label class="text-muted small">Location</label>
              <div class="fs-5">
                <% if @work_center.location.present? %>
                  <%= @work_center.location.name %>
                <% else %>
                  <span class="text-muted">Not specified</span>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Capacity & Performance Card -->
      <div class="card  mb-4">
        <div class="card-header d-flex align-items-center bg-success text-white">
          <h5 class="mb-0">
            <i class="fas fa-tachometer-alt me-2"></i> Capacity & Performance
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="text-muted small">Capacity per Hour</label>
              <div class="fs-4 fw-bold text-success">
                <%= number_with_precision(@work_center.capacity_per_hour, precision: 2) %>
                <small class="text-muted">units</small>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <label class="text-muted small">Efficiency</label>
              <div>
                <div class="progress" style="height: 30px;">
                  <div class="progress-bar <%= @work_center.efficiency_percent >= 90 ? 'bg-success' : @work_center.efficiency_percent >= 75 ? 'bg-warning' : 'bg-danger' %>" 
                       style="width: <%= @work_center.efficiency_percent %>%">
                    <strong><%= @work_center.efficiency_percent %>%</strong>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <label class="text-muted small">Effective Capacity</label>
              <div class="fs-4 fw-bold text-primary">
                <%= number_with_precision(@work_center.effective_capacity_per_hour, precision: 2) %>
                <small class="text-muted">units/hr</small>
              </div>
            </div>
          </div>

          <div class="alert alert-info mb-0">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Note:</strong> Effective capacity = 
            <%= number_with_precision(@work_center.capacity_per_hour, precision: 2) %> × 
            <%= @work_center.efficiency_percent %>% = 
            <%= number_with_precision(@work_center.effective_capacity_per_hour, precision: 2) %> units/hour
          </div>
        </div>
      </div>

      <!-- Time Settings Card -->
      <div class="card  mb-4">
        <div class="card-header d-flex align-items-center bg-secondary text-white">
          <h5 class="mb-0">
            <i class="fas fa-clock me-2"></i> Time Settings
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="text-muted small">Default Setup Time</label>
              <div class="fs-4 fw-bold">
                <%= @work_center.setup_time_minutes %>
                <small class="text-muted">minutes</small>
              </div>
              <small class="text-muted">
                <i class="fas fa-clock me-1"></i>
                <%= distance_of_time_in_words(@work_center.setup_time_minutes.minutes) %>
              </small>
            </div>
            <div class="col-md-6 mb-3">
              <label class="text-muted small">Average Queue Time</label>
              <div class="fs-4 fw-bold">
                <%= @work_center.queue_time_minutes %>
                <small class="text-muted">minutes</small>
              </div>
              <small class="text-muted">
                <i class="fas fa-hourglass-half me-1"></i>
                <%= distance_of_time_in_words(@work_center.queue_time_minutes.minutes) %>
              </small>
            </div>
          </div>
        </div>
      </div>

      <!-- Notes Card -->
      <% if @work_center.notes.present? %>
        <div class="card  mb-4">
          <div class="card-header d-flex align-items-center">
            <h5 class="mb-0">
              <i class="fas fa-sticky-note me-2"></i>Notes
            </h5>
          </div>
          <div class="card-body">
            <div class="border rounded p-3 bg-primary">
              <%= simple_format(@work_center.notes) %>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Right Column - Summary Cards -->
    <div class="col-lg-4">
      <!-- Cost Summary Card -->
      <div class="card  mb-4 border-warning">
        <div class="card-header d-flex align-items-center bg-warning text-dark">
          <h5 class="mb-0">
            <i class="fas fa-dollar-sign me-2"></i> Cost Summary
          </h5>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label class="text-muted small">Labor Cost per Hour</label>
            <div class="fs-4 fw-bold text-primary">
              $<%= number_with_precision(@work_center.labor_cost_per_hour, precision: 2) %>
            </div>
          </div>
          
          <div class="mb-3">
            <label class="text-muted small">Overhead Cost per Hour</label>
            <div class="fs-4 fw-bold text-info">
              $<%= number_with_precision(@work_center.overhead_cost_per_hour, precision: 2) %>
            </div>
          </div>
          
          <hr>
          
          <div class="mb-0">
            <label class="text-muted small">Total Cost per Hour</label>
            <div class="fs-3 fw-bold text-success">
              $<%= number_with_precision(@work_center.total_cost_per_hour, precision: 2) %>
            </div>
          </div>
        </div>
        <div class="card-footer bg-primary d-flex justify-content-start align-items-center">
          <small class="text-light">
            <i class="fas fa-calculator me-1"></i>
            Cost per minute: $<%= number_with_precision(@work_center.total_cost_per_hour / 60, precision: 2) %>
          </small>
        </div>
      </div>

      <!-- Cost Calculations Card -->
      <div class="card  mb-4 border-primary">
        <div class="card-header d-flex align-items-center bg-primary text-white">
          <h5 class="mb-0">
            <i class="fas fa-calculator me-2"></i> Quick Cost Calculator
          </h5>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label small">Run Time (minutes)</label>
            <input type="number" id="calc-run-time" class="form-control" value="60" min="1">
          </div>
          
          <div class="mb-3">
            <label class="form-label small">Quantity</label>
            <input type="number" id="calc-quantity" class="form-control" value="1" min="1">
          </div>
          
          <hr>
          
          <div class="mb-2">
            <label class="text-muted small">Setup Cost</label>
            <div class="fs-5 fw-bold">
              $<span id="calc-setup-cost">
                <%= number_with_precision(@work_center.calculate_setup_cost, precision: 2) %>
              </span>
            </div>
          </div>
          
          <div class="mb-2">
            <label class="text-muted small">Run Cost</label>
            <div class="fs-5 fw-bold">
              $<span id="calc-run-cost">0.00</span>
            </div>
          </div>
          
          <hr>
          
          <div>
            <label class="text-muted small">Total Cost</label>
            <div class="fs-4 fw-bold text-success">
              $<span id="calc-total-cost">0.00</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Future Usage Card (Placeholder) -->
      <div class="card  mb-4">
        <div class="card-header d-flex align-items-center bg-primary">
          <h5 class="mb-0">
            <i class="fas fa-route me-2"></i> Routing Usage
          </h5>
        </div>
        <div class="card-body text-center py-4">
          <i class="fas fa-route fa-3x text-muted mb-3"></i>
          <p class="text-muted mb-0">
            Will show routing operations<br>using this work center
          </p>
          <small class="text-muted">(Coming in Phase 2)</small>
        </div>
      </div>

      <!-- Audit Information Card -->
      <div class="card  mb-4">
        <div class="card-header d-flex align-items-center bg-primary">
          <h5 class="mb-0">
            <i class="fas fa-history me-2"></i> Audit Information
          </h5>
        </div>
        <div class="card-body">
          <div class="mb-2">
            <label class="text-muted small">Created At</label>
            <div>
              <%= @work_center.created_at.strftime("%B %d, %Y at %I:%M %p") %>
            </div>
          </div>
          
          <div class="mb-2">
            <label class="text-muted small">Last Updated</label>
            <div>
              <%= @work_center.updated_at.strftime("%B %d, %Y at %I:%M %p") %>
            </div>
          </div>
          
          <% if @work_center.created_by.present? %>
            <div class="mb-0">
              <label class="text-muted small">Created By</label>
              <div>
                <i class="fas fa-user me-1"></i>
                <%= @work_center.created_by.full_name || @work_center.created_by.email %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript for Cost Calculator -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const runTimeInput = document.getElementById('calc-run-time');
  const quantityInput = document.getElementById('calc-quantity');
  const setupCostSpan = document.getElementById('calc-setup-cost');
  const runCostSpan = document.getElementById('calc-run-cost');
  const totalCostSpan = document.getElementById('calc-total-cost');
  
  const costPerHour = <%= @work_center.total_cost_per_hour %>;
  const setupMinutes = <%= @work_center.setup_time_minutes %>;
  
  function calculateCosts() {
    const runMinutes = parseFloat(runTimeInput.value) || 0;
    const quantity = parseInt(quantityInput.value) || 1;
    
    // Setup cost (one time)
    const setupCost = (costPerHour / 60) * setupMinutes;
    
    // Run cost (per unit × quantity)
    const runCost = (costPerHour / 60) * runMinutes * quantity;
    
    // Total
    const totalCost = setupCost + runCost;
    
    setupCostSpan.textContent = setupCost.toFixed(2);
    runCostSpan.textContent = runCost.toFixed(2);
    totalCostSpan.textContent = totalCost.toFixed(2);
  }
  
  runTimeInput.addEventListener('input', calculateCosts);
  quantityInput.addEventListener('input', calculateCosts);
  
  // Initial calculation
  calculateCosts();
});
</script>