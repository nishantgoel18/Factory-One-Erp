<!-- app/views/suppliers/_form.html.erb -->
<!-- ============================================================================ -->
<!-- SUPPLIER FORM - Comprehensive form for creating/editing suppliers -->
<!-- ============================================================================ -->

<%= simple_form_for @supplier, html: { class: 'needs-validation', novalidate: true } do |f| %>
  
  <!-- Error Messages -->
  <%= render 'layouts/error_messages', object: @supplier %>
  

  <div class="row">
    <!-- Main Form Column -->
    <div class="col-lg-8">
      
      <!-- Basic Information Card -->
      <div class="card mb-4">
        <div class="card-header d-flex justify-content-start align-items-center bg-primary bg-opacity-10">
          <h5 class="mb-0"><i class="bi bi-building"></i> Basic Information</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <%= f.input :legal_name, required: true, 
                  hint: 'Official registered company name' %>
            </div>
            <div class="col-md-6">
              <%= f.input :trade_name, 
                  hint: 'Trading or DBA name (if different)' %>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-4">
              <%= f.input :supplier_type, required: true,
                  collection: Supplier.supplier_types.map { |t| [t.titleize, t] },
                  prompt: 'Select type...', input_html: {class: 'form-control'} %>
            </div>
            <div class="col-md-4">
              <%= f.input :supplier_category, required: true,
                  collection: Supplier.supplier_categories.map { |c| [c.titleize, c] },
                  prompt: 'Select category...', input_html: {class: 'form-control'} %>
            </div>
            <div class="col-md-4">
              <%= f.input :supplier_status, required: true,
                  collection: Supplier.supplier_statuses.map { |s| [s.titleize, s] },
                  prompt: 'Select status...', input_html: {class: 'form-control'} %>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <%= f.input :tax_id, label: 'Tax ID / EIN',
                  hint: 'Federal Tax Identification Number' %>
            </div>
            <div class="col-md-6">
              <%= f.input :supplier_since, as: :date,
                  html5: true,
                  hint: 'Date when supplier relationship started', input_html: {class: 'form-control'} %>
            </div>
          </div>
          
          <%= f.input :company_profile, as: :text,
              input_html: { rows: 4 },
              hint: 'Brief description of supplier capabilities and business' %>
        </div>
      </div>

      <!-- Contact Information Card -->
      <div class="card mb-4">
        <div class="card-header d-flex justify-content-start align-items-center bg-info bg-opacity-10">
          <h5 class="mb-0"><i class="bi bi-telephone"></i> Contact Information</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <%= f.input :primary_email, required: true,
                  input_html: { type: 'email' },
                  hint: 'Main email for correspondence' %>
            </div>
            <div class="col-md-6">
              <%= f.input :primary_phone, required: true,
                  hint: 'Main phone number' %>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <%= f.input :website,
                  hint: 'Company website URL' %>
            </div>
            <div class="col-md-6">
              <%= f.input :linkedin_url,
                  hint: 'LinkedIn company page' %>
            </div>
          </div>
        </div>
      </div>

      <!-- Financial Terms Card -->
      <div class="card mb-4">
        <div class="card-header d-flex justify-content-start align-items-center bg-success bg-opacity-10">
          <h5 class="mb-0"><i class="bi bi-currency-dollar"></i> Financial Terms</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4">
              <%= f.input :default_payment_terms, required: true,
                  collection: [
                    ['Net 15 Days', 'NET_15'],
                    ['Net 30 Days', 'NET_30'],
                    ['Net 45 Days', 'NET_45'],
                    ['Net 60 Days', 'NET_60'],
                    ['COD', 'COD'],
                    ['Advance Payment', 'ADVANCE']
                  ],
                  prompt: 'Select terms...', input_html: {class: 'form-control'} %>
            </div>
            <div class="col-md-4">
              <%= f.input :payment_method,
                  collection: [
                    ['Check', 'CHECK'],
                    ['Wire Transfer', 'WIRE'],
                    ['ACH', 'ACH'],
                    ['Credit Card', 'CREDIT_CARD']
                  ],
                  prompt: 'Select method...', input_html: {class: 'form-control'} %>
            </div>
            <div class="col-md-4">
              <%= f.input :currency, required: true,
                  collection: [['USD', 'USD'], ['CAD', 'CAD'], ['EUR', 'EUR']],
                  prompt: 'Select currency...', input_html: {class: 'form-control'} %>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <%= f.input :credit_limit_extended,
                  as: :decimal,
                  hint: 'Credit limit they extend to us' %>
            </div>
            <div class="col-md-6">
              <%= f.input :current_payable_balance,
                  as: :decimal,
                  hint: 'Current outstanding balance',
                  disabled: true %>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <%= f.input :early_payment_discount_percentage,
                  hint: 'Discount % for early payment' %>
            </div>
            <div class="col-md-6">
              <%= f.input :early_payment_discount_days,
                  hint: 'Days within which to pay for discount' %>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <%= f.input :requires_advance_payment,
                  as: :boolean,
                  label: 'Requires advance payment?' %>
            </div>
            <div class="col-md-6">
              <%= f.input :advance_payment_percentage,
                  hint: 'If advance required, what %?' %>
            </div>
          </div>
          
          <!-- Banking Details (Collapsible) -->
          <div class="mt-3">
            <a class="btn btn-sm btn-outline-secondary" data-bs-toggle="collapse" href="#bankingDetails">
              <i class="bi bi-bank"></i> Add Banking Details
            </a>
            <div class="collapse mt-3" id="bankingDetails">
              <div class="row">
                <div class="col-md-6">
                  <%= f.input :bank_name, hint: 'Name of bank' %>
                </div>
                <div class="col-md-6">
                  <%= f.input :bank_account_number, hint: 'Account number' %>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4">
                  <%= f.input :bank_routing_number, hint: 'Routing/ABA number' %>
                </div>
                <div class="col-md-4">
                  <%= f.input :bank_swift_code, hint: 'SWIFT/BIC code' %>
                </div>
                <div class="col-md-4">
                  <%= f.input :bank_iban, hint: 'IBAN (if applicable)' %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Manufacturing Capabilities Card -->
      <div class="card mb-4">
        <div class="card-header d-flex justify-content-start align-items-center bg-warning bg-opacity-10">
          <h5 class="mb-0"><i class="bi bi-gear"></i> Manufacturing Capabilities</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4">
              <%= f.input :default_lead_time_days, required: true,
                  hint: 'Standard lead time in days' %>
            </div>
            <div class="col-md-4">
              <%= f.input :minimum_order_quantity, required: true,
                  hint: 'Minimum order quantity' %>
            </div>
            <div class="col-md-4">
              <%= f.input :production_capacity_monthly,
                  hint: 'Monthly production capacity (units)' %>
            </div>
          </div>
        </div>
      </div>

      <!-- Certifications Card -->
      <div class="card mb-4">
        <div class="card-header d-flex justify-content-start align-items-center bg-secondary bg-opacity-10">
          <h5 class="mb-0"><i class="bi bi-patch-check"></i> Certifications</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4">
              <%= f.input :iso_9001_certified, as: :boolean,
                  label: 'ISO 9001 Certified?' %>
              <%= f.input :iso_9001_expiry, as: :date,
                  html5: true,
                  label: 'ISO 9001 Expiry', input_html: {class: 'form-control'} %>
            </div>
            <div class="col-md-4">
              <%= f.input :iso_14001_certified, as: :boolean,
                  label: 'ISO 14001 Certified?' %>
              <%= f.input :iso_14001_expiry, as: :date,
                  html5: true,
                  label: 'ISO 14001 Expiry', input_html: {class: 'form-control'} %>
            </div>
            <div class="col-md-4">
              <%= f.input :iso_45001_certified, as: :boolean,
                  label: 'ISO 45001 Certified?' %>
              <%= f.input :iso_45001_expiry, as: :date,
                  html5: true,
                  label: 'ISO 45001 Expiry', input_html: {class: 'form-control'} %>
            </div>
          </div>
        </div>
      </div>

      <!-- Initial Addresses (Nested) -->
      <div class="card mb-4">
        <div class="card-header d-flex justify-content-start align-items-center bg-primary bg-opacity-10">
          <h5 class="mb-0"><i class="bi bi-geo-alt"></i> Primary Address</h5>
        </div>
        <div class="card-body">
          <%= f.simple_fields_for :addresses do |address_form| %>
            <div class="row">
              <div class="col-md-6">
                <%= address_form.input :address_type,
                    collection: [
                      ['Primary Office', 'PRIMARY_OFFICE'],
                      ['Factory', 'FACTORY'],
                      ['Warehouse', 'WAREHOUSE']
                    ],
                    selected: 'PRIMARY_OFFICE' %>
              </div>
              <div class="col-md-6">
                <%= address_form.input :address_label,
                    hint: 'e.g., "Main Factory", "HQ Office"' %>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-12">
                <%= address_form.input :street_address_1, required: true %>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-12">
                <%= address_form.input :street_address_2 %>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-4">
                <%= address_form.input :city, required: true %>
              </div>
              <div class="col-md-4">
                <%= address_form.input :state_province, label: 'State/Province' %>
              </div>
              <div class="col-md-4">
                <%= address_form.input :postal_code, required: true %>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <%= address_form.input :country, required: true,
                    collection: [['United States', 'US'], ['Canada', 'CA']],
                    selected: 'US' %>
              </div>
              <div class="col-md-6">
                <%= address_form.input :contact_phone %>
              </div>
            </div>
            
            <%= address_form.input :is_default, as: :hidden, input_html: { value: true } %>
            <%= address_form.input :is_active, as: :hidden, input_html: { value: true } %>
          <% end %>
        </div>
      </div>

      <!-- Initial Contact (Nested) -->
      <div class="card mb-4">
        <div class="card-header d-flex justify-content-start align-items-center bg-info bg-opacity-10">
          <h5 class="mb-0"><i class="bi bi-person"></i> Primary Contact</h5>
        </div>
        <div class="card-body">
          <%= f.simple_fields_for :contacts do |contact_form| %>
            <div class="row">
              <div class="col-md-6">
                <%= contact_form.input :first_name, required: true %>
              </div>
              <div class="col-md-6">
                <%= contact_form.input :last_name, required: true %>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <%= contact_form.input :title, label: 'Job Title' %>
              </div>
              <div class="col-md-6">
                <%= contact_form.input :contact_role, required: true,
                    collection: [
                      ['Primary Contact', 'PRIMARY'],
                      ['Sales', 'SALES'],
                      ['Accounts Payable', 'ACCOUNTS_PAYABLE'],
                      ['Technical', 'TECHNICAL'],
                      ['Management', 'MANAGEMENT']
                    ],
                    selected: 'PRIMARY', input_html: {class: 'form-control'} %>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <%= contact_form.input :email, required: true,
                    input_html: { type: 'email' } %>
              </div>
              <div class="col-md-6">
                <%= contact_form.input :phone, required: true %>
              </div>
            </div>
            
            <%= contact_form.input :is_primary_contact, as: :hidden, input_html: { value: true } %>
            <%= contact_form.input :is_active, as: :hidden, input_html: { value: true } %>
          <% end %>
        </div>
      </div>

      <!-- Internal Notes -->
      <div class="card mb-4">
        <div class="card-header d-flex justify-content-start align-items-center">
          <h5 class="mb-0"><i class="bi bi-journal-text"></i> Internal Notes</h5>
        </div>
        <div class="card-body">
          <%= f.input :internal_notes, as: :text,
              input_html: { rows: 3 },
              hint: 'Internal notes (not visible to supplier)' %>
          
          <%= f.input :purchasing_notes, as: :text,
              input_html: { rows: 3 },
              hint: 'Notes for purchasing team' %>
        </div>
      </div>

    </div>

    <!-- Sidebar Column -->
    <div class="col-lg-4">
      
      <!-- Status & Flags Card -->
      <div class="card mb-4">
        <div class="card-header d-flex align-items-center justify-content-start">
          <h5 class="mb-0"><i class="bi bi-toggles"></i> Status & Flags</h5>
        </div>
        <div class="card-body">
          <%= f.input :is_active, as: :boolean,
              label: 'Active Supplier?' %>
          
          <%= f.input :can_receive_pos, as: :boolean,
              label: 'Can receive Purchase Orders?' %>
          
          <%= f.input :can_receive_rfqs, as: :boolean,
              label: 'Can receive RFQs?' %>
          
          <hr>
          
          <h6 class="text-muted mb-3">Strategic Flags</h6>
          
          <%= f.input :is_preferred_supplier, as: :boolean,
              label: 'Preferred Supplier?' %>
          
          <%= f.input :is_strategic_supplier, as: :boolean,
              label: 'Strategic Supplier?' %>
          
          <%= f.input :is_local_supplier, as: :boolean,
              label: 'Local Supplier?' %>
          
          <hr>
          
          <h6 class="text-muted mb-3">Diversity Flags</h6>
          
          <%= f.input :is_minority_owned, as: :boolean,
              label: 'Minority-Owned Business?' %>
          
          <%= f.input :is_woman_owned, as: :boolean,
              label: 'Woman-Owned Business?' %>
          
          <%= f.input :is_veteran_owned, as: :boolean,
              label: 'Veteran-Owned Business?' %>
        </div>
      </div>

      <!-- Assignment Card -->
      <div class="card mb-4">
        <div class="card-header d-flex align-items-center justify-content-start">
          <h5 class="mb-0"><i class="bi bi-person-badge"></i> Assignment</h5>
        </div>
        <div class="card-body">
          <%= f.association :default_buyer,
              collection: User.order(:full_name),
              label_method: :id,
              label_method: :full_name,
              prompt: 'Select buyer...',
              label: 'Default Buyer',
              hint: 'Primary buyer for this supplier', input_html: {class: 'form-control'} %>
          
          <%= f.input :supplier_territory,
              hint: 'Geographic territory or region' %>
        </div>
      </div>

      <!-- Tax & Compliance Card -->
      <div class="card mb-4">
        <div class="card-header d-flex align-items-center justify-content-start">
          <h5 class="mb-0"><i class="bi bi-file-text"></i> Tax & Compliance</h5>
        </div>
        <div class="card-body">
          <%= f.input :is_1099_vendor, as: :boolean,
              label: '1099 Vendor (US)?',
              hint: 'Requires IRS 1099 reporting' %>
          
          <%= f.input :requires_tax_withholding, as: :boolean,
              label: 'Tax withholding required?' %>
          
          <%= f.input :tax_withholding_percentage,
              hint: 'Withholding percentage if applicable' %>
        </div>
      </div>

      <!-- Help Card -->
      <div class="card bg-light">
        <div class="card-body">
          <h6><i class="bi bi-info-circle"></i> Quick Tips</h6>
          <small class="text-muted">
            <ul class="mb-0 ps-3">
              <li>All required fields marked with *</li>
              <li>You can add more addresses & contacts after saving</li>
              <li>Product catalog can be managed from detail page</li>
              <li>Rating is auto-calculated based on performance</li>
            </ul>
          </small>
        </div>
      </div>

    </div>
  </div>

  <!-- Form Actions -->
  <div class="row mt-4">
    <div class="col">
      <div class="d-flex justify-content-between">
        <%= link_to 'Cancel', @supplier.persisted? ? supplier_path(@supplier) : suppliers_path, 
            class: 'btn btn-outline-secondary' %>
        
        <div>
          <%= f.button :submit, 'Save Supplier', class: 'btn btn-primary' %>
        </div>
      </div>
    </div>
  </div>

<% end %>

<!-- Form Validation Script -->
<script>
(function() {
  'use strict';
  const forms = document.querySelectorAll('.needs-validation');
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  });
})();
</script>
